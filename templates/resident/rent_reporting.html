{% extends "base.html" %}

{% block title %}Rent Reporting{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-10 mx-auto">
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="{{ url_for('resident_dashboard') }}">Dashboard</a></li>
                <li class="breadcrumb-item active">Rent Reporting</li>
            </ol>
        </nav>

        <h2 class="mb-4">Rent Reporting</h2>

        <!-- What is Reported Explainer -->
        <div class="card mb-4 border-info">
            <div class="card-header bg-info text-white">
                <h5 class="mb-0"><i class="bi bi-info-circle"></i> What Gets Reported to Credit Bureaus</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <h6 class="text-success"><i class="bi bi-check-circle-fill"></i> What IS Reported:</h6>
                        <ul class="list-unstyled ms-3">
                            <li><i class="bi bi-check text-success"></i> Monthly rent payments</li>
                            <li><i class="bi bi-check text-success"></i> On-time payment history</li>
                            <li><i class="bi bi-check text-success"></i> Late payments (if applicable)</li>
                            <li><i class="bi bi-check text-success"></i> Account opened date</li>
                            <li><i class="bi bi-check text-success"></i> Payment schedule</li>
                        </ul>
                    </div>
                    <div class="col-md-6">
                        <h6 class="text-muted"><i class="bi bi-x-circle-fill"></i> What is NOT Reported:</h6>
                        <ul class="list-unstyled ms-3">
                            <li><i class="bi bi-x text-muted"></i> Utility payments</li>
                            <li><i class="bi bi-x text-muted"></i> Security deposits</li>
                            <li><i class="bi bi-x text-muted"></i> Pet fees or deposits</li>
                            <li><i class="bi bi-x text-muted"></i> Late fees or charges</li>
                            <li><i class="bi bi-x text-muted"></i> Other non-rent charges</li>
                        </ul>
                    </div>
                </div>
                <div class="alert alert-warning mb-0 mt-3">
                    <small><i class="bi bi-exclamation-triangle"></i> <strong>Important:</strong> We only report your base rent amount. This helps you build credit without including extra fees or charges.</small>
                </div>
            </div>
        </div>

        <!-- Next Reporting Date -->
        <div class="alert alert-primary mb-4">
            <div class="d-flex align-items-center">
                <i class="bi bi-calendar-event fs-4 me-3"></i>
                <div>
                    <strong>Next Scheduled Reporting: January 31, 2026</strong>
                    <p class="mb-0 small">Your payment history through January will be reported to credit bureaus</p>
                </div>
            </div>
        </div>

        <!-- Enrollment Status -->
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="mb-0">Enrollment Status</h5>
            </div>
            <div class="card-body">
                <div class="d-flex align-items-center justify-content-between">
                    <div>
                        <h4>
                            {% if resident.enrollment_status == 'enrolled' %}
                                <span class="badge bg-success status-badge">
                                    <i class="bi bi-check-circle"></i> Enrolled
                                </span>
                            {% else %}
                                <span class="badge bg-secondary status-badge">
                                    <i class="bi bi-x-circle"></i> Not Enrolled
                                </span>
                            {% endif %}
                        </h4>
                        <p class="text-muted mb-0">
                            {% if resident.enrollment_status == 'enrolled' %}
                                Your rent payments are being reported to credit bureaus.
                            {% else %}
                                You are not currently enrolled in rent reporting.
                            {% endif %}
                        </p>
                    </div>
                    <div>
                        {% if resident.enrollment_status == 'enrolled' %}
                            <a href="{{ url_for('resident_opt_out') }}" class="btn btn-outline-danger">
                                <i class="bi bi-x-circle"></i> Opt Out
                            </a>
                        {% else %}
                            <a href="{{ url_for('resident_enroll') }}" class="btn btn-primary">
                                <i class="bi bi-check-circle"></i> Enroll Now
                            </a>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>

        <!-- Account Summary -->
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="mb-0">Account Summary</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <dl class="row mb-0">
                            <dt class="col-sm-6">Account Number:</dt>
                            <dd class="col-sm-6"><strong>{{ resident.account_number }}</strong></dd>

                            <dt class="col-sm-6">Account Status:</dt>
                            <dd class="col-sm-6">
                                {% if resident.account_status == 'Current' %}
                                    <span class="badge bg-success">{{ resident.account_status }}</span>
                                {% else %}
                                    <span class="badge bg-danger">{{ resident.account_status }}</span>
                                {% endif %}
                            </dd>

                            <dt class="col-sm-6">Monthly Payment:</dt>
                            <dd class="col-sm-6">${{ "%.2f"|format(resident.scheduled_monthly_payment) }}</dd>

                            <dt class="col-sm-6">Payment Schedule:</dt>
                            <dd class="col-sm-6">{{ resident.payment_schedule }}</dd>
                        </dl>
                    </div>
                    <div class="col-md-6">
                        <dl class="row mb-0">
                            <dt class="col-sm-6">Account Opened:</dt>
                            <dd class="col-sm-6">{{ resident.date_opened }}</dd>

                            <dt class="col-sm-6">Last Payment:</dt>
                            <dd class="col-sm-6">{{ resident.date_last_payment }}</dd>

                            <dt class="col-sm-6">Amount Past Due:</dt>
                            <dd class="col-sm-6">
                                {% if resident.amount_past_due > 0 %}
                                    <span class="text-danger"><strong>${{ "%.2f"|format(resident.amount_past_due) }}</strong></span>
                                {% else %}
                                    <span class="text-success">${{ "%.2f"|format(resident.amount_past_due) }}</span>
                                {% endif %}
                            </dd>

                            <dt class="col-sm-6">Current Balance:</dt>
                            <dd class="col-sm-6">${{ "%.2f"|format(resident.current_balance) }}</dd>
                        </dl>
                    </div>
                </div>
            </div>
        </div>

        <!-- Payment History -->
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="mb-0">Payment History</h5>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>Month</th>
                                <th>Amount</th>
                                <th>Status</th>
                                <th>Days Late</th>
                                <th>Date Paid</th>
                                <th>Reported to Bureaus</th>
                                <th>Reported as Delinquent</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for payment in resident.payments %}
                            <tr>
                                <td>{{ payment.month }}</td>
                                <td>${{ "%.2f"|format(payment.amount) }}</td>
                                <td>
                                    {% if payment.status == 'Paid' %}
                                        <span class="badge bg-success">{{ payment.status }}</span>
                                    {% elif payment.status == 'Late' %}
                                        <span class="badge bg-warning text-dark">{{ payment.status }}</span>
                                    {% else %}
                                        <span class="badge bg-danger">{{ payment.status }}</span>
                                    {% endif %}
                                </td>
                                <td>
                                    {% if payment.days_late > 0 %}
                                        <span class="badge bg-warning text-dark">{{ payment.days_late }} days</span>
                                    {% else %}
                                        <span class="text-success">On time</span>
                                    {% endif %}
                                </td>
                                <td>
                                    {% if payment.date_paid %}
                                        {{ payment.date_paid }}
                                    {% else %}
                                        <span class="text-muted">Not paid</span>
                                    {% endif %}
                                </td>
                                <td>
                                    {% if payment.reported %}
                                        <i class="bi bi-check-circle-fill text-success"></i> Yes
                                    {% else %}
                                        <i class="bi bi-x-circle text-muted"></i> No
                                    {% endif %}
                                </td>
                                <td>
                                    {% if payment.reported and payment.days_late > 30 %}
                                        <span class="badge bg-danger"><i class="bi bi-exclamation-triangle"></i> Yes</span>
                                    {% elif payment.reported and payment.days_late > 0 %}
                                        <span class="badge bg-warning text-dark"><i class="bi bi-exclamation-circle"></i> Late</span>
                                    {% elif payment.reported %}
                                        <span class="text-success">No</span>
                                    {% else %}
                                        <span class="text-muted">N/A</span>
                                    {% endif %}
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Enrollment History -->
        {% if resident.enrollment_history %}
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="mb-0">Enrollment History</h5>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-sm">
                        <thead>
                            <tr>
                                <th>Action</th>
                                <th>Timestamp</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for event in resident.enrollment_history %}
                            <tr>
                                <td>
                                    {% if event.action == 'enrolled' %}
                                        <i class="bi bi-check-circle text-success"></i>
                                    {% elif event.action == 'revoked consent' %}
                                        <i class="bi bi-x-circle text-danger"></i>
                                    {% endif %}
                                    {{ event.action|title }}
                                </td>
                                <td>{{ event.timestamp }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        {% endif %}

        <!-- Dispute Guidance -->
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="mb-0"><i class="bi bi-question-circle"></i> How to Dispute Inaccurate Information</h5>
            </div>
            <div class="card-body">
                <p>If you believe any information reported about your account is inaccurate, you have the right to dispute it.</p>
                
                <h6 class="mt-3">Steps to Dispute:</h6>
                <ol>
                    <li><strong>Contact Us First:</strong> Reach out to our support team at <a href="mailto:support@example.com">support@example.com</a></li>
                    <li><strong>File with Credit Bureaus:</strong> You can also dispute directly with the credit bureaus:
                        <ul class="mt-2">
                            <li><a href="https://www.experian.com/disputes/main.html" target="_blank" class="text-decoration-none">Experian Dispute Center <i class="bi bi-box-arrow-up-right"></i></a></li>
                            <li><a href="https://www.equifax.com/personal/credit-report-services/" target="_blank" class="text-decoration-none">Equifax Dispute Center <i class="bi bi-box-arrow-up-right"></i></a></li>
                            <li><a href="https://www.transunion.com/credit-disputes/dispute-your-credit" target="_blank" class="text-decoration-none">TransUnion Dispute Center <i class="bi bi-box-arrow-up-right"></i></a></li>
                        </ul>
                    </li>
                    <li><strong>Provide Documentation:</strong> Include proof of payment (receipts, bank statements) with your dispute</li>
                    <li><strong>Track Your Dispute:</strong> The credit bureaus will investigate within 30 days</li>
                </ol>

                <div class="alert alert-info mb-0 mt-3">
                    <small><i class="bi bi-info-circle"></i> Disputes are handled through E-OSCAR (Electronic Online Solution for Complete and Accurate Reporting), the industry-standard system for resolving credit reporting disputes.</small>
                </div>

                <div class="mt-3">
                    <button class="btn btn-outline-primary" onclick="alert('View My Disputes feature coming soon')">
                        <i class="bi bi-list-check"></i> View My Disputes (Coming Soon)
                    </button>
                </div>
            </div>
        </div>

        <!-- Notification Preferences -->
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="mb-0"><i class="bi bi-bell"></i> Notification Preferences</h5>
            </div>
            <div class="card-body">
                <p class="text-muted mb-3">Choose when you'd like to receive email notifications</p>
                <div class="form-check mb-2">
                    <input class="form-check-input" type="checkbox" checked disabled id="notifyReport">
                    <label class="form-check-label" for="notifyReport">
                        When my payment is reported to credit bureaus
                    </label>
                </div>
                <div class="form-check mb-2">
                    <input class="form-check-input" type="checkbox" checked disabled id="notifyLate">
                    <label class="form-check-label" for="notifyLate">
                        When a payment is marked as late
                    </label>
                </div>
                <div class="form-check mb-3">
                    <input class="form-check-input" type="checkbox" checked disabled id="notifyEnrollment">
                    <label class="form-check-label" for="notifyEnrollment">
                        When my enrollment status changes
                    </label>
                </div>
                <button class="btn btn-primary" onclick="alert('Notification preferences feature coming soon')">
                    <i class="bi bi-save"></i> Save Preferences (Coming Soon)
                </button>
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">Quick Actions</h5>
            </div>
            <div class="card-body">
                <a href="{{ url_for('resident_profile') }}" class="btn btn-outline-primary">
                    <i class="bi bi-person-circle"></i> Update Personal Information
                </a>
                <a href="{{ url_for('resident_dashboard') }}" class="btn btn-outline-secondary">
                    <i class="bi bi-house-door"></i> Back to Dashboard
                </a>
            </div>
        </div>
    </div>
</div>
{% endblock %}
